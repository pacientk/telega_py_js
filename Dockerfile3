# Базовый образ для Node.js
FROM node:latest

# устанавливаем утилиты, необходимые для установки зависимостей
RUN apk update && apk add --no-cache apk-tools && apk add --no-cache --virtual .build-deps alpine-sdk python3

# устанавливаем пакеты для работы с Mysql
RUN apk add --no-cache mysql-client

# удаляем временные утилиты, чтобы уменьшить размер образа
RUN apk del .build-deps

# создаем директорию для приложения и устанавливаем рабочую директорию
RUN mkdir -p /app

# Установка рабочей директории внутри контейнера
WORKDIR /app

# Копирование package.json и package-lock.json
COPY package*.json ./

# Установка зависимостей
RUN npm install

# Копирование исходного кода в контейнер
COPY . /app

# Создание базы данных
RUN mysql -u root -e 'CREATE DATABASE IF NOT EXISTS telega_py_db;'

# Запуск приложения
CMD ["npm", "run", "dev"]



